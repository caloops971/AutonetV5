{
  "meta": {
    "$_GET": [
      {
        "type": "text",
        "name": "vehicle_id"
      }
    ]
  },
  "exec": {
    "steps": [
      {
        "name": "query",
        "module": "dbconnector",
        "action": "single",
        "options": {
          "connection": "autonetdb",
          "sql": {
            "type": "select",
            "columns": [],
            "params": [
              {
                "operator": "equal",
                "type": "expression",
                "name": ":P1",
                "value": "{{$_GET.vehicle_id}}",
                "test": ""
              }
            ],
            "table": {
              "name": "vehicle_data"
            },
            "primary": "id",
            "joins": [],
            "wheres": {
              "condition": "AND",
              "rules": [
                {
                  "id": "vehicle_data.id",
                  "field": "vehicle_data.id",
                  "type": "double",
                  "operator": "equal",
                  "value": "{{$_GET.vehicle_id}}",
                  "data": {
                    "table": "vehicle_data",
                    "column": "id",
                    "type": "number",
                    "columnObj": {
                      "type": "increments",
                      "primary": true,
                      "nullable": false,
                      "name": "id"
                    }
                  },
                  "operation": "=",
                  "table": "vehicle_data"
                }
              ],
              "conditional": null,
              "valid": true
            },
            "query": "select * from `vehicle_data` where `vehicle_data`.`id` = ?"
          }
        },
        "output": true,
        "meta": [
          {
            "type": "number",
            "name": "id"
          },
          {
            "type": "text",
            "name": "Brand"
          },
          {
            "type": "text",
            "name": "Model"
          },
          {
            "type": "text",
            "name": "Prix_de_vente_conseille"
          },
          {
            "type": "text",
            "name": "Economie"
          },
          {
            "type": "text",
            "name": "Votre_prix"
          },
          {
            "type": "text",
            "name": "Premiere_mise_en_circulation"
          },
          {
            "type": "text",
            "name": "Kilometrage"
          },
          {
            "type": "text",
            "name": "Puissance"
          },
          {
            "type": "text",
            "name": "Energie"
          },
          {
            "type": "text",
            "name": "Type_de_vehicule"
          },
          {
            "type": "text",
            "name": "Carrosserie"
          },
          {
            "type": "text",
            "name": "Couleur"
          },
          {
            "type": "text",
            "name": "Transmission"
          },
          {
            "type": "text",
            "name": "Couleur_exterieure"
          },
          {
            "type": "text",
            "name": "Consommation_urbaine_1"
          },
          {
            "type": "text",
            "name": "Consommation_extra_urbaine_1"
          },
          {
            "type": "text",
            "name": "Classe_d_efficience_energetique"
          },
          {
            "type": "text",
            "name": "Emissions_de_CO2_1"
          },
          {
            "type": "text",
            "name": "Equipements_principaux"
          },
          {
            "type": "text",
            "name": "Equipements"
          },
          {
            "type": "text",
            "name": "Numero_interne"
          },
          {
            "type": "text",
            "name": "Lieu"
          },
          {
            "type": "text",
            "name": "Disponibilite"
          },
          {
            "type": "text",
            "name": "Consommation_electr_mixte_1"
          },
          {
            "type": "number",
            "name": "Tarif"
          },
          {
            "type": "datetime",
            "name": "Created"
          },
          {
            "type": "datetime",
            "name": "Modified"
          },
          {
            "type": "text",
            "name": "Vehicle_Image"
          },
          {
            "type": "boolean",
            "name": "Desactive"
          },
          {
            "type": "number",
            "name": "cm3"
          }
        ],
        "outputType": "object"
      },
      {
        "name": "A",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{query.Equipements_principaux.replace('\\'', '\"')}}"
        },
        "meta": [],
        "outputType": "text",
        "output": false
      },
      {
        "name": "Equipements_principaux",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{A.parseJSON()}}"
        },
        "meta": [],
        "outputType": "text",
        "output": true
      },
      {
        "name": "B",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{query.Equipements.parseJSON()}}"
        },
        "meta": [],
        "outputType": "text",
        "output": true
      },
      {
        "name": "C",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{B.replace('\\'', '\"')}}"
        },
        "meta": [],
        "outputType": "text",
        "output": true,
        "disabled": true
      },
      {
        "name": "Equipements",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{C.parseJSON()}}"
        },
        "meta": [],
        "outputType": "text",
        "output": true,
        "disabled": true
      },
      {
        "name": "Pricing",
        "module": "dbupdater",
        "action": "custom",
        "options": {
          "connection": "autonetdb",
          "sql": {
            "query": "SELECT vd.id AS 'VehicleID', vd.Brand, vd.Model, vd.Tarif, vd.Lieu, si.price AS 'TransportTerrestre',\n       si.`to` AS 'PortDEP', si.shipper AS 'Transporteur', se.`to` AS 'Port DEST',\n       se.price AS 'TransportMaritime', se.shipper AS 'ShipperExt', se.`to` AS 'PortDESTExt',\n       vd.cm3, ti.OM, ti.OMR, ti.TVA,\n       ROUND(((vd.Tarif + si.price + se.price) + (vd.Tarif + si.price + se.price) * (ti.OM + ti.OMR + ti.TVA) / 100) * 1.15, 0) AS 'Prix_de_vente'\nFROM vehicle_data vd\nJOIN Shipping_int si ON vd.Lieu = si.`from`\nJOIN Shipping_ext se ON si.`to` = se.`from`\nJOIN tax_import ti ON vd.cm3 BETWEEN ti.cy_min AND ti.cy_max\nWHERE ti.territoire = 'PTP'\nAND ((vd.Tarif + si.price + se.price) + (vd.Tarif + si.price + se.price) * (ti.OM + ti.OMR + ti.TVA) / 100) * 1.15 =\n    (SELECT MIN(((vd.Tarif + si.price + se.price) + (vd.Tarif + si.price + se.price) * (ti.OM + ti.OMR + ti.TVA) / 100) * 1.15)\n     FROM vehicle_data vd\n     JOIN Shipping_int si ON vd.Lieu = si.`from`\n     JOIN Shipping_ext se ON si.`to` = se.`from`\n     JOIN tax_import ti ON vd.cm3 BETWEEN ti.cy_min AND ti.cy_max\n     WHERE ti.territoire = 'PTP'\n     AND vd.id = vd.id  AND vd.id=@vehicle_id) AND vd.id=@vehicle_id",
            "params": [
              {
                "name": "@vehicle_id",
                "value": "{{$_GET.vehicle_id}}",
                "test": "7"
              }
            ]
          }
        },
        "output": true,
        "meta": [
          {
            "name": "VehicleID",
            "type": "number"
          },
          {
            "name": "Brand",
            "type": "text"
          },
          {
            "name": "Model",
            "type": "text"
          },
          {
            "name": "Tarif",
            "type": "number"
          },
          {
            "name": "Lieu",
            "type": "text"
          },
          {
            "name": "TransportTerrestre",
            "type": "text"
          },
          {
            "name": "PortDEP",
            "type": "text"
          },
          {
            "name": "Transporteur",
            "type": "text"
          },
          {
            "name": "Port DEST",
            "type": "text"
          },
          {
            "name": "TransportMaritime",
            "type": "text"
          },
          {
            "name": "ShipperExt",
            "type": "text"
          },
          {
            "name": "PortDESTExt",
            "type": "text"
          },
          {
            "name": "cm3",
            "type": "number"
          },
          {
            "name": "OM",
            "type": "number"
          },
          {
            "name": "OMR",
            "type": "number"
          },
          {
            "name": "TVA",
            "type": "number"
          },
          {
            "name": "Prix_de_vente",
            "type": "number"
          }
        ]
      }
    ]
  }
}